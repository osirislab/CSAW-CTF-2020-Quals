FROM ubuntu:20.04

RUN apt-get update && apt-get install -y socat libc6-dev

RUN useradd -ms /bin/sh notmalware

WORKDIR /home/notmalware

COPY not_malware_deploy .
COPY flag.txt .

RUN chown -R root:notmalware /home/notmalware && \
    chown root:notmalware /home/notmalware/flag.txt && \
    chmod 440 /home/notmalware/flag.txt && \
    chmod 555 not_malware_deploy


EXPOSE 8000
USER notmalware
CMD ["socat", "-T60", "TCP-LISTEN:8000,reuseaddr,fork","EXEC:/home/notmalware/not_malware_deploy"]
