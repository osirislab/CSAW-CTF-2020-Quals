FROM ubuntu:18.04

RUN apt-get update && apt-get upgrade -y
RUN apt-get install -y socat

#user
RUN adduser --disabled-password --gecos '' notmalware
RUN chown -R root:notmalware /home/notmalware/
RUN chmod 750 /home/notmalware
RUN chmod 740 /usr/bin/top
RUN chmod 740 /bin/ps
RUN chmod 740 /usr/bin/pgrep

WORKDIR /home/notmalware

COPY notmalware ./
COPY flag.txt ./flag.txt

RUN chown root:notmalware /home/notmalware/flag.txt
RUN chmod 440 /home/notmalware/flag.txt

EXPOSE 8000
CMD ["socat", "-T60", "TCP-LISTEN:8000,reuseaddr,fork,su=notmalware", "EXEC:/home/notmalware/notmalware"]

